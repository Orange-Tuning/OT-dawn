<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<style>
  .sd-formFields .sd-filter {
    background: url("{{ 'select_arrow.png' | asset_url }}") center right no-repeat;
      }
</style>

{% assign finalmf = "" %}

<div class="page-width">
  {% if section.settings.title != blank %}
  <div class="title h3 sd-title">
    {{ section.settings.title }}
  </div>
  {% endif %}
  <div class="sd-formFields">
    <ul class="sd-dropdowns">
      <li class="sd-field_1">       
        <div class="dropdown">
          <button id="dropbtn1" class="dropbtn sd-filter">Maker</button>
          <div id="dropdown-field_1" class="dropdown-content">
            <input type="text" placeholder="Search.." id="myInput1" class="myInput">
            <div class="dropdown-content-list">
            {% for link in linklists.maker.links %}
            <a href="#" data-value="{{ link.handle }}">{{ link.title }}</a>
            {% endfor %}
            </div>
          </div>
        </div>       
      </li>
      <li class="sd-field_2">        
       <div class="dropdown">
          <button id="dropbtn2" class="dropbtn sd-filter" disabled>Model</button>
          <div id="dropdown-field_2" class="dropdown-content">
            <input type="text" placeholder="Search.." id="myInput2" class="myInput">  
            <div class="dropdown-content-list">
            </div>
          </div>
        </div> 
      </li>
      <li class="sd-field_3">        
       <div class="dropdown">
          <button id="dropbtn3" class="dropbtn sd-filter" disabled>Parts</button>
          <div id="dropdown-field_3" class="dropdown-content">
            <input type="text" placeholder="Search.." id="myInput3" class="myInput">
            <div class="dropdown-content-list">
            </div>
          </div>
        </div> 
      </li>
      <li class="sd-field_4">        
        <div class="dropdown">
          <button id="dropbtn4" class="dropbtn sd-filter" disabled>Manufacturer</button>
          <div id="dropdown-field_4" class="dropdown-content">
            <input type="text" placeholder="Search.." id="myInput4" class="myInput">   
            <div class="dropdown-content-list">
            </div>
          </div>
        </div> 
      </li>      
      <li class="sd_bttns">
        <div id="ymm_actions" class="button-action" align="center">
          <input type="button" name="submit" id="sd_search" value="GO" class="button sd_search"/>
          <input type="button" name="reset" id="sd_reset" value="Reset" class="button sd_reset"/>
        </div>
      </li>
    </ul>
  </div>
</div>

{% schema %}
{
"name": "t:sections.search-dropdowns.name",
"tag": "section",
"class": "section",
"settings": [
{
"type": "text",
"id": "title",
"default": "Search Dropdowns",
"label": "t:sections.search-dropdowns.settings.title.label"
}  
],
"presets": [
{
"name": "t:sections.search-dropdowns.presets.name"
}
]
}
{% endschema %}
<script> 
 $(document).ready(function(){

    var menuArr = [{ {% for link in linklists.maker.links %}{% if link.links != blank %}"{{ link.handle }}":{ {% for child_link in link.links %}{% if child_link.links != blank %}"{{ child_link.handle }}" :[ {% for grandchild_link in child_link.links %}"{{grandchild_link.handle}}"{% unless forloop.last %},{% endunless %}{% endfor %} ],{% else %}"{{ child_link.handle }}":"{{ child_link.handle }}",{% endif %}{% endfor %} }, {% else %}"{{ link.handle }}":"{{ link.handle }}",{% endif %}{% endfor %} }];
    var mfgArr = [{% for link in shop.metafields.manufacturer.handle1 %}"{{link.value}}",{% endfor %}{% for link in shop.metafields.manufacturer.handle2 %}"{{link.value}}",{% endfor %}{% for link in shop.metafields.manufacturer.handle3 %}"{{link.value}}",{% endfor %}];
    var arr, current_field, dropdown_val1, dropdown_val2, dropdown_val3, dropdown_val4,search_tag,tagstr,newtext;
    
    console.log("menuArr ::"+JSON.stringify(menuArr));  
    console.log("mfgArr :: "+mfgArr);     
    disableSearch();
    //Out side click
    $(document).on("click", function(event){
        var $trigger = $(".dropdown");
        if($trigger !== event.target && !$trigger.has(event.target).length){          
          //console.log("trigger");
          $(".dropdown-content").hide();
        }            
    });
      //Drop btn Click
    $(document).on('click','.dropbtn',function() {
      $(".dropdown").removeClass("active");
      $(this).parents(".dropdown").addClass("active");
      $(".dropdown").not(".active").find(".dropdown-content").hide();
      $(this).parents(".dropdown").find(".dropdown-content").toggle();     
    }); 
    // dropdown1
    $(document).on('click','#dropdown-field_1 a',function() {
      
      $(this).parents(".dropdown").find(".dropdown-content").toggle();      
      dropdown_val1 = $(this).attr("data-value");  
      newtext = dropdown_val1.toString().replace(/-/g, " ");
      var flag = 0;
	  $(this).parents(".dropdown").find(".dropbtn").text(newtext);
      tagstr = dropdown_val1;
      $("#dropdown-field_2 a").remove(); 
      $("#dropdown-field_3 a").remove(); 
      $("#dropdown-field_4 a").remove();
      $("#dropbtn2").text('Model').prop('disabled',true);
      $("#dropbtn3").text('Parts').prop('disabled',true);
      $("#dropbtn4").text('Manufacturer').prop('disabled',true);
      enableSearch();
      $.each(menuArr,function(key,val){ 
       // console.log("val ::"+JSON.stringify(val));
        //console.log("dropdown_val :: "+dropdown_val1);
        $.each(val,function(key1,val1){
          if(key1 == dropdown_val1)  
          { 
           // console.log("val1 ::"+JSON.stringify(val1));
            if(jQuery.type(val1) === 'object'){ 
              flag = 1;
              $.each(val1,function(key2,val2){                  
                $("#dropdown-field_2 .dropdown-content-list").append("<a href='#' data-value='"+key2+"'>"+key2.replace("-", " ")+"</a>");
              });
            }
            /*else{              
              $("#dropdown-field_2 .dropdown-content-list").append("<a href='#' data-value='"+key1+"'>"+val1.replace("-", " ")+"</a>");
            }*/
          }
        });
      });
      if(flag == 1) {
      $("#dropbtn2").prop('disabled',false); 
      }
      else{
        $("#dropbtn2").prop('disabled',true); 
      }
    });
    //Dropdown 2
    $(document).on('click','#dropdown-field_2 a',function() {      
      dropdown_val2 = $(this).attr("data-value");
      newtext = dropdown_val2.toString().replace(/-/g, " ");
      $(this).parents(".dropdown").find(".dropbtn").text(newtext);
      tagstr = dropdown_val1+"_"+dropdown_val2;
      $("#dropdown-field_3 a").remove();     
      $("#dropdown-field_4 a").remove();     
      $("#dropbtn3").text('Parts').prop('disabled',true);
      $("#dropbtn4").text('Manufacturer').prop('disabled',true);  
      var flag = 0;
      $.each(menuArr,function(key,val){ 
       // console.log("val ::"+JSON.stringify(val));
       // console.log("dropdown_val :: "+dropdown_val1);
        $.each(val,function(key1,val1){
          if(key1 == dropdown_val1)  
          { 
         //   console.log("val1 ::"+JSON.stringify(val1));
            if(jQuery.type(val1) === 'object'){              
              $.each(val1,function(key2,val2){                
                if(key2 == dropdown_val2)  
                {  
               //   console.log("in if key2 :: val2");
                  if(Array.isArray(val2)){
                    flag = 1;
                 //   console.log("yes object");
                    $.each(val2,function(key3,val3){
                    var newval = val3.toString().replace(/-/g, " ");
                  //  console.log("newval :: "+newval);
                    $("#dropdown-field_3 .dropdown-content-list").append("<a href='#' data-value='"+val3+"'>"+newval+"</a>");
                    });
                    }
                  else{
                    var newval1 = val2.toString().replace(/-/g, " ");
                //    console.log("newval1 :: "+newval1);
                    $("#dropdown-field_3 .dropdown-content-list").append("<a href='#' data-value='"+newval1+"'>"+newval1+"</a>");
                    
                  }
                  if(flag == 1)
                  {
                    $("#dropbtn3").prop('disabled',false);
                  } 
                  else{
                 //   console.log("parts else");
                    $("#dropbtn3").prop('disabled',true); 
                  }
                }
              });
            }           
          }
        });
      });      
      $(this).parents(".dropdown").find(".dropdown-content").toggle();
      
    });  
    //Dropdown 3
    $(document).on('click','#dropdown-field_3 a',function() {
      dropdown_val3 = $(this).attr("data-value");
      newtext = dropdown_val3.toString().replace(/-/g, " ");
      $(this).parents(".dropdown").find(".dropbtn").text(newtext);
      tagstr = dropdown_val1+"_"+dropdown_val2+"_"+dropdown_val3;
      // disableSearch();
      $("#dropdown-field_4 a").remove().prop('disabled',true);    
      $("#dropbtn4").text("Manufacturer");
      var mfgstr = dropdown_val1+"_"+dropdown_val2+"_"+dropdown_val3;
     // console.log("mfgstr :: "+mfgstr);
      var flag = 0;
      $.each(mfgArr,function(key,val){
        //console.log("val :: "+val);
       // console.log("mfgstr :: "+mfgstr);
        if(val.indexOf(mfgstr) > -1)  
        {   
          flag = 1;
          var mfgnewval = val.substring(val.lastIndexOf('_')).replace("_",'').replace("-"," ");
         // console.log("mfgnewval :: "+mfgnewval);          
          $("#dropdown-field_4 .dropdown-content-list").append("<a href='#' data-value='"+val.substring(val.lastIndexOf('_')).replace("_",'')+"'>"+val.substring(val.lastIndexOf('_')).replace("_",'').replace("-"," ")+"</a>");
          
        }
        if(flag == 1)
        {          
        	$("#dropbtn4").prop('disabled',false);
        } 
        else{         
           $("#dropbtn4").prop('disabled',true); 
        }
      });       
       $(this).parents(".dropdown").find(".dropdown-content").toggle(); 
      
    }); 
     //Dropdown 4    
    $(document).on('click','#dropdown-field_4 a',function() {        
      dropdown_val4 = $(this).attr("data-value");
      newtext = dropdown_val4.toString().replace(/-/g, " ");
      $(this).parents(".dropdown").find(".dropbtn").text(newtext);
      enableSearch();
      tagstr = dropdown_val1+"_"+dropdown_val2+"_"+dropdown_val3+"_"+dropdown_val4; 
      $(this).parents(".dropdown").find(".dropdown-content").toggle();
      
    });
    //Search Click
    $(document).on('click','#sd_search',function() {
      var pageurl = "https://orange-tuning.myshopify.com/search?q=tag:";
      window.location.replace(pageurl+tagstr);
    });
    // Reset Click
    $(document).on('click','#sd_reset',function() {
      disableSearch();     
      $("#dropdown-field_2 a").remove();
      $("#dropdown-field_3 a").remove();
      $("#dropdown-field_4 a").remove();     
      $("#dropbtn2").prop('disabled',true);
      $("#dropbtn3").prop('disabled',true);
      $("#dropbtn4").prop('disabled',true);
      $("#dropbtn1").text('Maker');
      $("#dropbtn2").text('Model');
      $("#dropbtn3").text('Parts');
      $("#dropbtn4").text('Manufacturer');
    });
     
    // input seach box
    $("input.myInput").keyup(function(){
      var filter, a, i;      
      filter = $(this).val().toUpperCase();
      //console.log("filter :: "+filter);
      a = $(this).parents(".dropdown-content").find("a");
      for (i = 0; i < a.length; i++) {
        var txtValue = a[i].textContent || a[i].innerText;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
          a[i].style.display = "";
        } else {
          a[i].style.display = "none";
        }
      }
    });
  
  });  
  
  function disableSearch()
  {
    $("#sd_search").prop('disabled',true);
  }
  function enableSearch()
  {
    $("#sd_search").prop('disabled',false);
  }
 
</script>